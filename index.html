<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Contacto</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="form-container">
            <h1>Formulario de Contacto</h1>
            <p class="form-description">Complete el formulario para registrar su información</p>
            
            <form class="registration-form" id="registrationForm">
                <div class="form-group">
                    <label for="nombre">Nombre completo:</label>
                    <input type="text" id="nombre" name="nombre" required>
                    <span class="error-message" id="nombreError"></span>
                </div>
                
                <div class="form-group">
                    <label for="edad">Edad:</label>
                    <input type="number" id="edad" name="edad" min="18" max="120" required>
                    <span class="error-message" id="edadError"></span>
                </div>

                <!-- PAÍS PRIMERO -->
                <div class="form-group">
                    <label for="pais">País:</label>
                    <select id="pais" name="pais" required>
                        <option value="">Selecciona tu país</option>
                        <option value="honduras">Honduras</option>
                        <option value="nicaragua">Nicaragua</option>
                        <option value="guatemala">Guatemala</option>
                    </select>
                    <span class="error-message" id="paisError"></span>
                </div>

                <!-- TELÉFONO SEGUNDO CON CÓDIGO AUTOMÁTICO -->
                <div class="form-group">
                    <label for="telefono">Teléfono:</label>
                    <div class="phone-input-container" style="display: flex; gap: 5px;">
                        <input type="text" id="countryCode" readonly style="width: 60px; background: #f5f5f5; text-align: center;" placeholder="Código">
                        <input type="tel" id="telefono" name="telefono" placeholder="8613-9476" required style="flex: 1;">
                    </div>
                    <span class="error-message" id="telefonoError"></span>
                </div>

                <div id="countryLogoPreview" class="country-logo-preview"></div>
                
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span class="btn-text">Enviar</span>
                    <span class="btn-loader" style="display: none;">Enviando...</span>
                </button>
            </form>

            <!-- Mensaje de éxito -->
            <div class="success-message" id="successMessage" style="display: none;">
                <div class="success-icon">✓</div>
                <h2>¡Registro exitoso!</h2>
                <p>Sus datos han sido guardados correctamente.</p>
                <button class="new-form-btn" onclick="resetForm()">Nuevo registro</button>
            </div>

            <!-- Mensaje de error -->
            <div class="error-container" id="errorContainer" style="display: none;">
                <div class="error-icon">⚠</div>
                <h3>Error al enviar</h3>
                <p id="errorMessage"></p>
                <button class="retry-btn" onclick="hideError()">Intentar de nuevo</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://publicidad-b-1.onrender.com/api/submit/';
        
        // Detectar si NO es Chrome
        function detectBrowser() {
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            
            if (!isChrome) {
                // Mostrar mensaje recomendando Chrome
                showBrowserWarning();
            }
        }

        function showBrowserWarning() {
            const warningDiv = document.createElement('div');
            warningDiv.innerHTML = `
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 10px; border-radius: 5px;">
                    <h4>⚠️ Recomendación</h4>
                    <p>Para una mejor experiencia, recomendamos usar <strong>Google Chrome</strong>.</p>
                    <p>Si tienes problemas, intenta:</p>
                    <ul>
                        <li>Desactivar el bloqueador de anuncios</li>
                        <li>Abrir en Google Chrome</li>
                    </ul>
                </div>
            `;
            document.body.insertBefore(warningDiv, document.body.firstChild);
        }


        
        // Códigos de país
        const COUNTRY_CODES = {
            honduras: '+504',
            nicaragua: '+505',
            guatemala: '+502'
        };
        
        const COMPANY_LOGOS_MAP = {
            honduras: [
                { name: 'Empresa A Honduras', logo: 'logo/1.jpeg' },
                { name: 'Empresa B Honduras', logo: 'logo/2.jpeg' },
                { name: 'Empresa C Honduras', logo: 'logo/3.jpeg' },
                { name: 'Empresa D Honduras', logo: 'logo/4.jpeg' },
                { name: 'Empresa E Honduras', logo: 'logo/5.jpeg' }
            ],
            nicaragua: [
                { name: 'Empresa Nicaragua', logo: 'logo/6.jpeg' }
            ],
            guatemala: [
                { name: 'Empresa Guatemala', logo: 'logo/7.jpeg' }
            ]
        };

        let selectedCompany = null;

        // Elementos del DOM
        const form = document.getElementById('registrationForm');
        const submitBtn = document.getElementById('submitBtn');
        const btnText = document.querySelector('.btn-text');
        const btnLoader = document.querySelector('.btn-loader');
        const successMessage = document.getElementById('successMessage');
        const errorContainer = document.getElementById('errorContainer');
        const countryLogoPreview = document.getElementById('countryLogoPreview');

        // Actualizar código de país cuando se selecciona el país
        document.getElementById('pais').addEventListener('change', function() {
            const selectedCountry = this.value;
            const countryCodeInput = document.getElementById('countryCode');
            
            if (selectedCountry && COUNTRY_CODES[selectedCountry]) {
                countryCodeInput.value = COUNTRY_CODES[selectedCountry];
            } else {
                countryCodeInput.value = '';
            }
            
            // Mantener la funcionalidad existente de logos
            updateCountryLogos(selectedCountry);
        });

        // Preview de logos por país con selección
        function updateCountryLogos(selectedCountry) {
            countryLogoPreview.innerHTML = '';
            selectedCompany = null; // Reset selección
            
            if (selectedCountry && COMPANY_LOGOS_MAP[selectedCountry]) {
                const companies = COMPANY_LOGOS_MAP[selectedCountry];
                
                companies.forEach((company, index) => {
                    const companyDiv = document.createElement('div');
                    companyDiv.className = 'company-option';
                    companyDiv.innerHTML = `
                        <img src="${company.logo}" alt="${company.name}" class="company-logo">
                        <p class="company-name">${company.name}</p>
                    `;
                    
                    companyDiv.addEventListener('click', function() {
                        // Remover selección previa
                        document.querySelectorAll('.company-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        
                        // Seleccionar actual
                        this.classList.add('selected');
                        selectedCompany = company.name;
                    });
                    
                    countryLogoPreview.appendChild(companyDiv);
                });
                
                countryLogoPreview.style.display = 'grid';
            } else {
                countryLogoPreview.style.display = 'none';
            }
        }

        // Envío del formulario
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Limpiar errores previos
            clearErrors();
            
            // Obtener datos del formulario
            const formData = {
                name: document.getElementById('nombre').value,
                age: parseInt(document.getElementById('edad').value),
                phone: document.getElementById('countryCode').value + ' ' + document.getElementById('telefono').value, // Combinar código + número
                country: document.getElementById('pais').value,
                company: selectedCompany
            };

            // Validación frontend
            if (!validateForm(formData)) {
                return;
            }

            // Mostrar estado de carga
            setLoadingState(true);

            try {
                const response = await fetch(`${API_BASE_URL}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (response.ok) {
                    showSuccess();
                } else {
                    showError(data);
                }
            } catch (error) {
                console.error('Error de conexión:', error);
                showError({
                    message: 'Error de conexión. Verifique que el servidor esté funcionando.'
                });
            } finally {
                setLoadingState(false);
            }
        });

        // Validación del formulario
        function validateForm(data) {
            let isValid = true;

            if (!data.name || data.name.length < 2) {
                showFieldError('nombreError', 'El nombre debe tener al menos 2 caracteres');
                isValid = false;
            }

            if (!data.age || data.age < 18 || data.age > 120) {
                showFieldError('edadError', 'La edad debe estar entre 18 y 120 años');
                isValid = false;
            }

            if (!data.phone || data.phone.length < 7) {
                showFieldError('telefonoError', 'Ingrese un número de teléfono válido');
                isValid = false;
            }

            if (!data.country) {
                showFieldError('paisError', 'Seleccione un país');
                isValid = false;
            }

            // Validar que se haya seleccionado una empresa
            if (data.country && !data.company) {
                showFieldError('paisError', 'Seleccione una empresa');
                isValid = false;
            }

            return isValid;
        }

        // Mostrar error en campo específico
        function showFieldError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // Limpiar todos los errores
        function clearErrors() {
            const errorElements = document.querySelectorAll('.error-message');
            errorElements.forEach(element => {
                element.style.display = 'none';
                element.textContent = '';
            });
        }

        // Estado de carga
        function setLoadingState(loading) {
            if (loading) {
                submitBtn.disabled = true;
                btnText.style.display = 'none';
                btnLoader.style.display = 'inline';
            } else {
                submitBtn.disabled = false;
                btnText.style.display = 'inline';
                btnLoader.style.display = 'none';
            }
        }

        // Mostrar mensaje de éxito
        function showSuccess() {
            form.style.display = 'none';
            successMessage.style.display = 'block';
            errorContainer.style.display = 'none';
        }

        // Mostrar error general
        function showError(errorData) {
            const errorMessage = document.getElementById('errorMessage');
            
            if (errorData.message) {
                errorMessage.textContent = errorData.message;
            } else if (errorData.age) {
                errorMessage.textContent = `Error en edad: ${errorData.age[0]}`;
            } else if (errorData.country) {
                errorMessage.textContent = `Error en país: ${errorData.country[0]}`;
            } else {
                errorMessage.textContent = 'Error desconocido. Intente de nuevo.';
            }
            
            errorContainer.style.display = 'block';
        }

        // Ocultar error
        function hideError() {
            errorContainer.style.display = 'none';
        }

        // Resetear formulario
        function resetForm() {
            form.reset();
            form.style.display = 'block';
            successMessage.style.display = 'none';
            errorContainer.style.display = 'none';
            countryLogoPreview.style.display = 'none';
            clearErrors();
        }

        // DETECTOR DE NAVEGADOR Y MENSAJE DE ADVERTENCIA
        function detectBrowser() {
            // TEMPORAL - siempre mostrar mensaje para probar
            if (true) {
                showBrowserWarning();
            }
        }

        function showBrowserWarning() {
            // Crear el mensaje de advertencia
            const warningDiv = document.createElement('div');
            warningDiv.id = 'browserWarning';
            warningDiv.style.cssText = `
                background: #fff3cd;
                border: 2px solid #ffc107;
                padding: 15px;
                margin: 10px 0;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                position: relative;
            `;
            
            warningDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="font-size: 24px;">⚠️</div>
                    <div style="flex: 1;">
                        <h4 style="margin: 0 0 8px 0; color: #856404;">Recomendación Importante</h4>
                        <p style="margin: 0 0 10px 0; color: #856404;">
                            Detectamos que estás usando un navegador con bloqueador integrado. Para evitar problemas de conexión:
                        </p>
                        <ul style="margin: 0; padding-left: 20px; color: #856404;">
                            <li><strong>Desactiva el bloqueador de anuncios para este sitio</strong></li>
                            <li>O usa <strong>Google Chrome o Microsoft Edge</strong></li>
                            <li>Prueba en modo incógnito/privado</li>
                        </ul>
                    </div>
                    <button onclick="closeBrowserWarning()" style="
                        background: #ffc107;
                        border: none;
                        border-radius: 50%;
                        width: 30px;
                        height: 30px;
                        cursor: pointer;
                        font-weight: bold;
                        color: #856404;
                    ">×</button>
                </div>
            `;
            
            // Insertar al inicio del contenedor principal
            const container = document.querySelector('.form-container');
            container.insertBefore(warningDiv, container.firstChild);
        }

        function closeBrowserWarning() {
            const warning = document.getElementById('browserWarning');
            if (warning) {
                warning.remove();
            }
        }

        // Ejecutar detector al cargar la página
        window.addEventListener('load', detectBrowser);
    </script>
</body>
</html>